---
layout: post
title: IC卡——基础知识
date: 2017-08-30
categories: SMART CARD
tags: [IC-CARD,DRIVER,BUS]
description: IC-CARD STUDY AND APPLICATION
---

## **1.概念介绍**

IC卡 (Integrated Circuit Card，集成电路卡)，也称智能卡(Smart card)、智慧卡(Intelligent card)、微电路卡(Microcircuit card)或微芯片卡等。它是将一个**微电子芯片**嵌入符合**ISO 7816**标准的卡基中，做成卡片形式。IC卡与读写器之间的通讯方式可以是接触式，也可以是非接触式。根据通讯接口把IC卡分成接触式IC卡、非接触式IC和双界面卡（同时具备接触式与非接触式通讯接口）。

## **2.工作原理**

IC卡基本原理：射频读写器向IC卡发一组**固定频率的电磁波**，**卡片内有一个LC串联谐振电路**，其频率与读写器发射的频率相同，这样在电磁波激励下，LC谐振电路产生共振，从而使电容内有了电荷；在这个电容的另一端，接有一个单向导通的电子泵，将电容内的电荷送到另一个电容内存储，当所积累的电荷达到2V时，此电容可作为电源为其它电路提供工作电压，将卡内数据发射出去或接受读写器的数据。

#### **2.1非接触性IC卡发射原理：**

非接触性IC卡与读卡器之间通过无线电波来完成读写操作。二者之间的通讯频率为13.56MHZ。非接触性IC卡本身是无源卡，当读写器对卡进行读写操作时，读写器发出的信号由两部分叠加组成:一部分是电源信号，该信号由卡接收后，与本身的L/C产生一个瞬间能量来供给芯片工作。另一部分则是指令和数据信号，指挥芯片完成数据的读取、修改、储存等，并返回信号给读写器,完成一次读写操作。读写器则一般由单片机，专用智能模块和天线组成，并配有与PC的通讯接口，打印口，I/O口等，以便应用于不同的领域。

![这里写图片描述](http://img.blog.csdn.net/20170830153010496?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvd3d0MTg4MTE3MDc5NzE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

**非接触式IC卡操作:**

![这里写图片描述](http://img.blog.csdn.net/20170830102202317?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvd3d0MTg4MTE3MDc5NzE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

#### **2.2接触性IC卡：**

通过卡片表面的8个金属触点与读卡设备进行物理连接来实现电源供给和完成通信，
必须保证接触点的稳定性。

![这里写图片描述](http://img.blog.csdn.net/20170830101721546?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvd3d0MTg4MTE3MDc5NzE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

**接触式智能IC卡操作过程：**

![这里写图片描述](http://img.blog.csdn.net/20170830102029806?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvd3d0MTg4MTE3MDc5NzE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

## **3.IC卡结构**

![这里写图片描述](http://img.blog.csdn.net/20170830093644817?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvd3d0MTg4MTE3MDc5NzE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

智能卡是由硬件和软件两部分构成，智能卡的硬件部分是集成电路，集成电路的外在形式是芯片，内部组成是各种功能的集成部件，包括CPU、RAM、EEPROM、ROM、等，不同的芯片，其硬件配置不同，功能也不同。智能卡的软件部分是COS， COS是用户的应用程序与卡的交互界面，是卡内各硬件部件的总调度师，是卡的安全卫士，是实现各相关国际标准的基础。COS通常都有自己的安全体系，它的安全性能通常是衡量COS的重要技术指标。

## **4.接口标准**

IC卡读写器要能读写符合**ISO7816**标准的IC卡。IC卡接口电路作为IC卡与IFD内的CPU进行通信的唯一通道，为保证通信和数据交换的安全与可靠，其产生的电信号必须满足严格的时序要求。

● ISO 10536：识别卡－非接触式的集成电路卡；

● ISO 7816：识别卡－带触点的集成电路卡；

● ISO7816-1：规定卡的物理特性。卡的物理特性中描述了卡应达到的防护紫外线的能力、X光照射的剂量、卡和触点的机械强度、抗电磁干扰能力等等。

● ISO7816-2：规定卡的尺寸和位置。

● ISO7816-3：规定卡的电信号和传输协议。传输协议包括两种：**同步传输协议和异步传输协议**。

● ISO7816-4：规定卡的行业间交换用命令。包括：在卡与读写间传送的命令和应答信息内容；在卡中的文件、数据结构及访问方法；定义在卡中的文件和数据访问权限及安全结构。

## **5.智能卡操作系统**

**COS：**全称是Chip Operating System(片内操作系统)，它一般是紧紧围绕着它所服务的智能卡的特点而开发的。由于不可避免地受到了智能卡内微处理器芯片的性能及内存容量的影响，因此，COS在很大程度上不同于我们通常所能见到的微机上的操作系统(例如DOS、UNIX等)。

#### **5.1COS的特点**

（1）COS是一个专用系统而不是通用系统。即：一种COS一般都只能应用于特定的某种(或者是某些)智能卡，不同卡内的COS一般是不相同的。因为COS一般都是根据某种智能卡的特点及其应用范围而特定设计开发的，尽管它们在所实际完成的功能上可能大部分都遵循着同一个国际标准。

（2）与常见的微机上的操作系统相比较而言，COS在本质上更加接近于监控程序、而不是一个通常所谓的真正意义上的操作系统。在当前阶段，COS所需要解决的主要还是**对外部的命令如何进行处理、响应的问题**，这其中一般并不涉及到共享、并发的管理及处理。

![这里写图片描述](http://img.blog.csdn.net/20170830141721495?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvd3d0MTg4MTE3MDc5NzE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

COS对于智能卡内部数据和资源的管理主要涉及通信接口上的数据处理和转发、应用数据的调用、内存空间维护。通信接口上的数据处理和转发表现为命令响应对的处理，即接受读写设备发来的命令数据，转发给相关的应用，接收应用处理后的响应数据转发给读写设备。应用数据的调用主要表现为应用代码的执行、文件系统维护及安全管理控制，这期间涉及到了芯片底层硬件的驱动，包括存储器的读写、算法协处理器的使用和随机数发生器等芯片硬件资源的使用。在以上数据通信管理和应用数据调用的过程中，COS要不断的对卡内的内存空间进行合理的分配、使用、回收、再利用，以确保系统稳定、安全、高效的运行。


#### **5.2COS的基本原理**

COS在设计时一般都是紧密结合智能卡内存储器分区的情况，按照国际标准(ISO /IEC 7816系列标准)中所规定的一些功能进行设计、开发。**COS的主要功能是控制智能卡和外界的信息交换，管理智能卡内的存储器并在卡内部完成各种命令的处理。**其中，与外界进行信息交换是COS最基本的要求。在交换过程中，COS所遵循的信息交换协议包括两类：**异步字符传输的 T=0协议以及异步分组传输的T=1协议**。

无论是采用T=0协议还T=1协议，智能卡在信息交换时使用的都是**异步通信模式**；而且由于智能卡的数据端口只有一个，此信息交换也只能采用**半双工**的方式，即在任一时刻，数据端口上最多只能有一方（智能卡或者读写设备）在发送数据。T=0、T=1协议的不同之处在于它们数据传输的单位和格式不一样，**T=0协议以单字节的字符为基本单位，T=1协议则以有一定长度的数据块为传输的基本单位。**


#### **5.3COS的功能**

包括：传输管理、文件管理、安全体系、命令解释，这是内部机理。在外部使用来看就只是有触点的智能卡。

COS的开发，首先的解决传输管理问题，即I/O问题，智能卡通过触点（非接触卡是通过场与读写设备交换数据的，遵循的国际标准是14443）和读写设备交换数据的，就是对国际标准ISO7816-3的实现。

　　文件管理，对各种类型的文件都要有一种访问机制，以存储用户数据，既要高效，又要安全。COS的安全体系，是COS中的重要部分，是以**密码算法**为基础的，通过密码算法，控制用户的权限，什么情况下允许外部对智能卡进行什么操作。命令解释是对行业规范中的命令和智能卡专用命令的实现，一条命令有时是多种功能的综合体，命令解释部分要对命令作出解释，根据权限满足情况，控制各种功能的实现。

#### **5.4COS的安全体系**

COS的安全机制所实现的就是如下三个功能：鉴别与核实，数据加密与解密，文件访问的安全控制。

COS的评判，一方面是看功能实现情况，有没有按照应用行业的标准或规范，实现规定的指令，在功能方面是否存在隐患。另一方面是看**安全性**，安全性是智能卡的重要方面，如果留有明显的安全漏洞，则COS是失败的。一个好的COS还要有较高的运行效率。


#### **5.5密码技术**

密码：就是利用一种算法，用特定的密钥对叫做明文的用户数据进行变形处理，这个变换的过程叫做加密，经加密的数据是不可识别的，称为密文，只有在合法情况下，用特定的密钥，以规定的算法对密文进行逆向变换，才可恢复出明文，逆变换的过程叫做解密。现代密码学中，算法是公开的，需要保密的是密钥。

密码算法是多种多样的，主要有两大类密码算法，一类是**对称密钥密码算法**，如DES，IDEA，AES等，另一类是**非对称密码算法**，如RSA，DSA等。

密码算法的单向性，已知算法、密钥、明文，计算密文很容易。但是反过来计算就很难了，已知算法、明文、密文，是计算不出密钥的。




## **参考：**

1.[IC卡](https://baike.baidu.com/item/IC卡/155035?fr=aladdin)

2.[IC卡基础知识](https://wenku.baidu.com/view/ad3627eeb8f67c1cfad6b8e6.html)

3.[CPU卡](https://baike.baidu.com/item/CPU%E5%8D%A1?fr=aladdin)

4.[智能卡操作系统COS概述](http://blog.csdn.net/tongdh/article/details/17301459)

5.[智能卡与COS技术简析](http://tech.yktchina.com/2013-12/3517cb2b0c16e2d3.html)

6.[通用卡片操作系统COS测试平台建设与COS测试](http://tech.yktworld.com/201308/201308130949216446.html)